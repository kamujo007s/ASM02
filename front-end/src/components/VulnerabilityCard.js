import React from 'react';
import moment from 'moment';

const VulnerabilityCard = ({ vulnerability }) => {
  const {
    cveId,
    device_name,
    operating_system,
    os_version,
    cvssScore,
    riskLevel,
    descriptions,
    published,
    lastModified,
    configurations,
    cvssVersion,
  } = vulnerability;

  return (
    <div className="card mb-3">
      <div className="card-header">
        <h5 className="card-title">
          <a
            href={`https://nvd.nist.gov/vuln/detail/${cveId}`}
            target="_blank"
            rel="noopener noreferrer"
          >
            {cveId}
          </a>
        </h5>
        <h6 className="card-subtitle mb-2 text-muted">
          {device_name} - {operating_system} {os_version}
        </h6>
      </div>
      <div className="card-body">
        <p>
          <strong>CVSS Score:</strong> {cvssScore || "N/A"} ({cvssVersion})
        </p>
        <p>
          <strong>Risk Level:</strong>{" "}
          <span className={`risk-level ${riskLevel}`}>{riskLevel}</span>
        </p>
        <p>
          <strong>Description:</strong>{" "}
          {descriptions.find((desc) => desc.lang === "en")?.value ||
            "No description available"}
        </p>
        <p>
          <strong>Published:</strong>{" "}
          {moment(published).isValid()
            ? moment(published).format("YYYY-MM-DD")
            : "Invalid Date"}
        </p>
        <p>
          <strong>Last Modified:</strong>{" "}
          {moment(lastModified).isValid()
            ? moment(lastModified).format("YYYY-MM-DD")
            : "Invalid Date"}
        </p>
        <div>
          <strong>Configurations:</strong>
          <ul>
            {configurations && Array.isArray(configurations) && configurations.length > 0 ? (
              configurations.map((config, index) => (
                Array.isArray(config) && config.map((match, i) => (
                  <li key={`${index}-${i}`}>
                    {`Criteria: ${match.criteria}, Match ID: ${match.matchCriteriaId}`}
                  </li>
                ))
              ))
            ) : (
              <li>No Configurations available</li>
            )}
          </ul>
        </div>
      </div>
    </div>
  );
};

export default VulnerabilityCard;
