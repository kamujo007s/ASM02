//Vulnerability.js
const mongoose = require('mongoose');

const cpeMatchSchema = new mongoose.Schema({
  criteria: { type: String, required: true },
  matchCriteriaId: { type: String, required: true },
}, { strict: true }); // เพิ่ม strict: true

const vulnerabilitySchema = new mongoose.Schema({
  asset: { type: mongoose.Schema.Types.ObjectId, ref: 'Asset', required: true },
  operating_system: { type: String, required: true },
  os_version: { type: String, required: true },
  cveId: { type: String, required: true },
  published: Date,
  lastModified: Date,
  vulnStatus: String,
  descriptions: Array,
  riskLevel: { type: String, required: true },
  cvssVersion: String,
  cvssScore: Number,
  configurations: [cpeMatchSchema], // เก็บ CPE matches เป็น array ของ Object
  weaknesses: Array,
  cpeNameUsed: { type: [String], required: true },
}, { strict: true }); // เพิ่ม strict: true

const Vulnerability = mongoose.model('Vulnerability', vulnerabilitySchema);

module.exports = Vulnerability;